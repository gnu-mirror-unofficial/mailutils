# This file is part of GNU Mailutils. -*- Autotest -*-
# Copyright (C) 2015-2021 Free Software Foundation, Inc.
#
# GNU Mailutils is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 3, or (at
# your option) any later version.
#
# GNU Mailutils is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with GNU Mailutils.  If not, see <http://www.gnu.org/licenses/>.

AT_SETUP([Reply])
AT_KEYWORDS([reply])

AT_DATA([inbox],
[From hare@wonder.land Mon Jul 29 22:00:08 2002
Received: (from hare@wonder.land) 
	by wonder.land id 3301
	for alice@wonder.land; Mon, 29 Jul 2002 22:00:06 +0100
Date: Mon, 29 Jul 2002 22:00:01 +0100
From: March Hare  <hare@wonder.land>
Message-Id: <200207292200.3301@wonder.land>
To: Alice  <alice@wonder.land>
Subject: Invitation

Have some wine

From alice@wonder.land Mon Jul 29 22:00:09 2002
Received: (from alice@wonder.land) 
	by wonder.land id 3302
	for hare@wonder.land; Mon, 29 Jul 2002 22:00:07 +0100
Date: Mon, 29 Jul 2002 22:00:02 +0100
From: Alice  <alice@wonder.land>
Message-Id: <200207292200.3302@wonder.land>
To: March Hare  <hare@wonder.land>
Subject: Re: Invitation

I don't see any wine

From hatter@example.org Mon Jul 29 22:00:10 2002
Received: (from hatter@example.org) 
	by wonder.land id 3303
	for alice@wonder.land; Mon, 29 Jul 2002 22:00:08 +0100
Date: Mon, 29 Jul 2002 22:00:03 +0100
From: Hatter <hatter@example.org>
Message-Id: <200207292200.3303@wonder.land>
To: Alice  <alice@wonder.land>
Subject: Re: Invitation

There isn't any

From alice@wonder.land Mon Jul 29 22:00:11 2002
Received: (from alice@wonder.land) 
	by wonder.land id 3304
	for hare@wonder.land; Mon, 29 Jul 2002 22:00:09 +0100
Date: Mon, 29 Jul 2002 22:00:04 +0100
From: Alice  <alice@wonder.land>
Message-Id: <200207292200.3304@wonder.land>
To: March Hare  <hare@wonder.land>
Subject: Re: Invitation

Then it wasn't very civil of you to offer it

From hare@wonder.land Mon Jul 29 22:00:12 2002
Received: (from hare@wonder.land) 
	by wonder.land id 3305
	for alice@wonder.land; Mon, 29 Jul 2002 22:00:10 +0100
Date: Mon, 29 Jul 2002 22:00:05 +0100
From: March Hare  <hare@wonder.land>
Message-Id: <200207292200.3305@wonder.land>
To: Alice  <alice@wonder.land>
Subject: Re: Invitation

It wasn't very civil of you to sit down without being invited
])

AT_CHECK([touch record
mkdir folder outfolder
])

AT_CHECK([
AT_DATA([com],
[set dot indentprefix=">"
retain To
Reply 2 1 3
~m
.
x
])

unset MAIL_DUMP
MUT_MAIL_CMD -f ./inbox \
             -E "set noheader" \
             -E "set sendmail=$MAILER" \
             -E "set record=$(pwd)/record" \
	     -E "set folder=$(pwd)/folder" \
	     -E "set outfolder" < com
],
[0],
[To: "Alice" <alice@wonder.land>,"March Hare" <hare@wonder.land>,"Hatter" <hatter@example.org>
Subject: Re: Invitation

Interpolating: 2
(continue)
])

AT_CHECK([
sed -e '/^SENDER:/d' \
    -e '/^Date:/d' \
    -e '/^X-Mailer:/d' \
    mail.dump],
[0],
[MSGID: 0001
NRCPT: 3
RCPT[[0]]: <alice@wonder.land>
RCPT[[1]]: <hare@wonder.land>
RCPT[[2]]: <hatter@example.org>
LENGTH: 396
To: "Alice" <alice@wonder.land>,"March Hare" <hare@wonder.land>,"Hatter" <hatter@example.org>
Subject: Re: Invitation
In-Reply-To: Your message of Mon, 29 Jul 2002 22:00:02 +0100
	<200207292200.3302@wonder.land>
References: <200207292200.3302@wonder.land>

>To: March Hare  <hare@wonder.land>
>
>I don't see any wine
>

])

AT_CHECK([sed -e '1s/^From .*/Envelope/' \
    -e '/^X-[[a-zA-Z]]*:/d' \
    -e '/^Date:/d' record
],
[0],
[Envelope
To: "Alice" <alice@wonder.land>,"March Hare" <hare@wonder.land>,"Hatter" <hatter@example.org>
Subject: Re: Invitation
In-Reply-To: Your message of Mon, 29 Jul 2002 22:00:02 +0100
	<200207292200.3302@wonder.land>
References: <200207292200.3302@wonder.land>

>To: March Hare  <hare@wonder.land>
>
>I don't see any wine
>

])


AT_CLEANUP
	     
