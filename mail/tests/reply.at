# This file is part of GNU Mailutils. -*- Autotest -*-
# Copyright (C) 2015-2021 Free Software Foundation, Inc.
#
# GNU Mailutils is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 3, or (at
# your option) any later version.
#
# GNU Mailutils is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with GNU Mailutils.  If not, see <http://www.gnu.org/licenses/>.

AT_SETUP([reply])
AT_KEYWORDS([reply])

AT_DATA([inbox],
[From hare@wonder.land Mon Jul 29 22:00:08 2002
Received: (from hare@wonder.land) 
	by wonder.land id 3301
	for alice@wonder.land; Mon, 29 Jul 2002 22:00:06 +0100
Date: Mon, 29 Jul 2002 22:00:01 +0100
From: March Hare  <hare@wonder.land>
Message-Id: <200207292200.3301@wonder.land>
To: Alice  <alice@wonder.land>
Subject: Invitation

Have some wine

])

AT_CHECK([touch record
mkdir folder outfolder
])

AT_CHECK([
AT_DATA([com],
[set dot indentprefix=">"
retain To
reply 1
~m
.
x
])

unset MAIL_DUMP
MUT_MAIL_CMD -f ./inbox \
             -E "set noheader" \
             -E "set sendmail=$MAILER" \
             -E "set record=$(pwd)/record" \
	     -E "set folder=$(pwd)/folder" \
	     -E "set outfolder" < com
],
[0],
[To: "March Hare" <hare@wonder.land>,"Alice" <alice@wonder.land>
Subject: Re: Invitation

Interpolating: 1
(continue)
])

AT_CHECK([
sed -e '/^SENDER:/d' \
    -e '/^Date:/d' \
    -e '/^X-Mailer:/d' \
    mail.dump],
[0],
[MSGID: 0001
NRCPT: 2
RCPT[[0]]: <hare@wonder.land>
RCPT[[1]]: <alice@wonder.land>
LENGTH: 356
To: "March Hare" <hare@wonder.land>,"Alice" <alice@wonder.land>
Subject: Re: Invitation
In-Reply-To: Your message of Mon, 29 Jul 2002 22:00:01 +0100
	<200207292200.3301@wonder.land>
References: <200207292200.3301@wonder.land>

>To: Alice  <alice@wonder.land>
>
>Have some wine
>

])

AT_CHECK([
sed -e '1s/^From .*/Envelope/' \
    -e '/^X-[[a-zA-Z]]*:/d' \
    -e '/^Date:/d' record],
[0],    
[Envelope
To: "March Hare" <hare@wonder.land>,"Alice" <alice@wonder.land>
Subject: Re: Invitation
In-Reply-To: Your message of Mon, 29 Jul 2002 22:00:01 +0100
	<200207292200.3301@wonder.land>
References: <200207292200.3301@wonder.land>

>To: Alice  <alice@wonder.land>
>
>Have some wine
>

])

AT_CLEANUP
	     
